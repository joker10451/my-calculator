# Nginx конфигурация для favicon файлов и HTTP заголовков
# Этот файл нужно включить в основную конфигурацию Nginx

# Настройка MIME типов для favicon файлов
location ~* \.(ico)$ {
    add_header Content-Type image/x-icon;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header X-Content-Type-Options "nosniff";
    add_header Access-Control-Allow-Origin "*";
    add_header Cross-Origin-Resource-Policy "cross-origin";
    add_header Vary "Accept-Encoding";
    
    # Включаем сжатие для ICO файлов (если они большие)
    gzip on;
    gzip_types image/x-icon;
}

# SVG иконки
location ~ ^/icon\.svg$ {
    add_header Content-Type "image/svg+xml";
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header X-Content-Type-Options "nosniff";
    add_header Access-Control-Allow-Origin "*";
    add_header Cross-Origin-Resource-Policy "cross-origin";
    add_header Vary "Accept-Encoding";
    
    # SVG файлы хорошо сжимаются
    gzip on;
    gzip_types image/svg+xml;
}

# Apple Touch Icon и PWA иконки
location ~* ^/(apple-touch-icon|icon-\d+)\.png$ {
    add_header Content-Type "image/png";
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header X-Content-Type-Options "nosniff";
    add_header Access-Control-Allow-Origin "*";
    add_header Cross-Origin-Resource-Policy "cross-origin";
    add_header Vary "Accept-Encoding";
    
    # PNG файлы обычно уже сжаты, но можно попробовать
    gzip on;
    gzip_types image/png;
}

# Web App Manifest
location ~ ^/manifest\.json$ {
    add_header Content-Type "application/json; charset=utf-8";
    add_header Cache-Control "public, max-age=86400";
    add_header X-Content-Type-Options "nosniff";
    add_header Access-Control-Allow-Origin "*";
    add_header Cross-Origin-Resource-Policy "cross-origin";
    add_header Vary "Accept-Encoding";
    
    # JSON файлы хорошо сжимаются
    gzip on;
    gzip_types application/json;
}

# Общие заголовки безопасности
add_header X-Frame-Options "DENY" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Настройка сжатия для всех текстовых файлов
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_proxied any;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/xml+rss
    application/atom+xml
    image/svg+xml;

# Настройка Brotli сжатия (если модуль доступен)
# brotli on;
# brotli_comp_level 6;
# brotli_types
#     text/plain
#     text/css
#     text/xml
#     text/javascript
#     application/json
#     application/javascript
#     application/xml+rss
#     application/atom+xml
#     image/svg+xml;