# Implementation Plan: Project Improvement Plan

## Overview

Данный план реализации разбивает комплексное улучшение проекта Считай.RU на дискретные, выполнимые задачи. План организован по приоритетам: сначала критические улучшения (производительность, безопасность, тестирование), затем функциональные расширения и улучшения UX.

Каждая задача строится на предыдущих, обеспечивая инкрементальный прогресс с валидацией на каждом этапе.

## Tasks

- [ ] 1. Настройка инфраструктуры тестирования и анализа
  - Установить и настроить fast-check для property-based тестирования
  - Настроить Vitest для запуска property тестов с минимум 100 итерациями
  - Установить инструменты анализа: Bundle Analyzer, Lighthouse CI
  - Настроить pre-commit hooks для автоматического запуска тестов
  - _Requirements: 3.2, 3.6_

- [ ]* 1.1 Написать базовые property тесты для валидации инфраструктуры
  - Создать простой property тест для проверки работы fast-check
  - Убедиться, что тесты запускаются с правильной конфигурацией
  - _Requirements: 3.2_

- [ ] 2. Реализация системы валидации и безопасности
  - [ ] 2.1 Создать централизованный ValidationEngine
    - Реализовать класс ValidationEngine с методами для всех типов валидации
    - Добавить методы: validateType, validateRange, validateFormat, sanitizeInput
    - Интегрировать DOMPurify для XSS защиты
    - _Requirements: 10.1, 10.2_

  - [ ]* 2.2 Написать property тест для валидации входных данных
    - **Property 8: Input validation coverage**
    - **Validates: Requirements 10.1**
    - Генерировать случайные валидные и невалидные входные данные
    - Проверять, что валидация корректно принимает/отклоняет данные

  - [ ]* 2.3 Написать property тест для XSS защиты
    - **Property 9: XSS protection sanitization**
    - **Validates: Requirements 10.2**
    - Генерировать потенциально опасные строки с HTML/JS
    - Проверять, что все опасные элементы санитизируются

  - [ ] 2.4 Реализовать систему обработки ошибок
    - Создать ErrorHandler с методами captureError, captureMessage
    - Реализовать React Error Boundaries для UI ошибок
    - Добавить fallback UI компоненты
    - Интегрировать логирование ошибок
    - _Requirements: 10.3, 10.4, 10.5_

  - [ ]* 2.5 Написать property тест для graceful error handling
    - **Property 10: Graceful error handling with logging**
    - **Validates: Requirements 10.3, 10.5**
    - Генерировать различные типы ошибок
    - Проверять, что приложение не падает и ошибки логируются

  - [ ] 2.6 Реализовать rate limiting middleware
    - Создать RateLimiter с конфигурируемыми лимитами
    - Добавить middleware для защиты API endpoints
    - _Requirements: 10.6_

  - [ ]* 2.7 Написать property тест для rate limiting
    - **Property 12: Rate limiting enforcement**
    - **Validates: Requirements 10.6**
    - Генерировать множество запросов
    - Проверять, что лимиты корректно применяются

- [ ] 3. Checkpoint - Безопасность и валидация
  - Убедиться, что все тесты безопасности проходят
  - Проверить, что ValidationEngine интегрирован во все формы
  - Спросить пользователя, если возникли вопросы

- [ ] 4. Создание базовой архитектуры для калькуляторов
  - [ ] 4.1 Создать абстрактный базовый класс AbstractCalculator
    - Реализовать интерфейс BaseCalculator<TInput, TOutput>
    - Добавить общие методы: validate, format, saveToHistory, export
    - Создать защищенные поля: validator, formatter, history
    - _Requirements: 4.1, 4.2, 4.3_

  - [ ] 4.2 Создать хук useCalculatorCommon для общей логики
    - Реализовать useState для inputs/outputs
    - Добавить обработку ошибок
    - Добавить интеграцию с ValidationEngine
    - Добавить автосохранение в историю
    - _Requirements: 4.1, 4.2_

  - [ ] 4.3 Создать компонент CalculatorPageWrapper
    - Реализовать общий layout для всех калькуляторов
    - Добавить breadcrumbs, navigation, help section
    - Интегрировать error boundaries
    - _Requirements: 4.2, 5.1_

  - [ ]* 4.4 Написать unit тесты для базовых компонентов
    - Тестировать AbstractCalculator с mock данными
    - Тестировать useCalculatorCommon hook
    - Тестировать CalculatorPageWrapper rendering
    - _Requirements: 4.1, 4.2_

- [ ] 5. Реализация системы истории расчетов
  - [ ] 5.1 Создать HistoryManager для управления историей
    - Реализовать методы: save, load, list, delete, clear
    - Использовать localStorage для персистентности
    - Добавить ограничение размера истории (maxSize)
    - _Requirements: 6.3_

  - [ ]* 5.2 Написать property тест для истории расчетов
    - **Property 3: Calculation history round-trip**
    - **Validates: Requirements 6.3**
    - Генерировать случайные результаты расчетов
    - Проверять round-trip: save → load → verify equality

  - [ ] 5.3 Создать UI компонент для отображения истории
    - Реализовать HistoryPanel с списком расчетов
    - Добавить фильтрацию и сортировку
    - Добавить возможность загрузки расчета из истории
    - _Requirements: 6.3_

  - [ ] 5.4 Реализовать сохранение состояния при навигации
    - Использовать sessionStorage для временного состояния
    - Интегрировать с React Router для восстановления состояния
    - _Requirements: 5.3_

  - [ ]* 5.5 Написать property тест для сохранения состояния
    - **Property 1: State persistence across navigation**
    - **Validates: Requirements 5.3**
    - Генерировать случайные состояния калькуляторов
    - Симулировать навигацию и проверять восстановление состояния

- [ ] 6. Checkpoint - Базовая архитектура
  - Убедиться, что все базовые компоненты работают
  - Проверить интеграцию с существующими калькуляторами
  - Спросить пользователя, если возникли вопросы

- [ ] 7. Реализация системы экспорта результатов
  - [ ] 7.1 Создать ExportEngine с поддержкой множества форматов
    - Реализовать экспорт в JSON (встроенный)
    - Реализовать экспорт в CSV (используя библиотеку)
    - Реализовать экспорт в Excel (используя xlsx)
    - Реализовать экспорт в PDF (используя jsPDF)
    - _Requirements: 6.4_

  - [ ]* 7.2 Написать property тест для экспорта
    - **Property 4: Export format validity**
    - **Validates: Requirements 6.4**
    - Генерировать случайные результаты расчетов
    - Экспортировать в каждый формат и проверять валидность файла

  - [ ] 7.3 Добавить UI кнопки экспорта в калькуляторы
    - Создать ExportButton компонент с dropdown меню форматов
    - Интегрировать в CalculatorPageWrapper
    - _Requirements: 6.4_

- [ ] 8. Реализация системы сравнения результатов
  - [ ] 8.1 Создать ComparisonSystem для сравнения результатов
    - Реализовать методы: addToComparison, removeFromComparison, compare
    - Создать алгоритм выявления различий между результатами
    - Добавить генерацию рекомендаций на основе сравнения
    - _Requirements: 6.1_

  - [ ]* 8.2 Написать property тест для системы сравнения
    - **Property 2: Comparison system consistency**
    - **Validates: Requirements 6.1**
    - Генерировать множество результатов расчетов
    - Проверять, что сравнение всегда возвращает структурированный результат

  - [ ] 8.3 Создать UI для сравнения результатов
    - Реализовать ComparisonPanel с таблицей сравнения
    - Добавить визуализацию различий
    - Добавить кнопку "Добавить к сравнению" в калькуляторы
    - _Requirements: 6.1_

- [ ] 9. Реализация системы аналитики и мониторинга
  - [ ] 9.1 Создать AnalyticsTracker для отслеживания событий
    - Реализовать методы: trackPageView, trackEvent, trackCalculation, trackConversion
    - Интегрировать с Google Analytics / Yandex Metrika
    - Добавить буферизацию событий для оптимизации
    - _Requirements: 8.1, 8.2_

  - [ ] 9.2 Создать ErrorTracker для отслеживания ошибок
    - Интегрировать с Sentry или аналогичным сервисом
    - Добавить автоматический захват ошибок
    - Добавить контекст пользователя к ошибкам
    - _Requirements: 8.3_

  - [ ]* 9.3 Написать property тест для event tracking
    - **Property 7: Event tracking completeness**
    - **Validates: Requirements 8.1, 8.2, 8.3**
    - Генерировать различные пользовательские действия
    - Проверять, что все события корректно отслеживаются

  - [ ] 9.4 Интегрировать аналитику во все калькуляторы
    - Добавить tracking в useCalculatorCommon hook
    - Отслеживать начало расчета, завершение, ошибки
    - Отслеживать клики по партнерским ссылкам
    - _Requirements: 8.1, 8.2_

- [ ] 10. Checkpoint - Функциональные системы
  - Убедиться, что экспорт, сравнение и аналитика работают
  - Проверить интеграцию со всеми калькуляторами
  - Спросить пользователя, если возникли вопросы

- [ ] 11. Улучшение SEO оптимизации
  - [ ] 11.1 Создать SEOManager для управления мета-тегами
    - Реализовать генерацию уникальных title/description для каждой страницы
    - Добавить поддержку Open Graph и Twitter Cards
    - Интегрировать с React Helmet или аналогом
    - _Requirements: 7.1_

  - [ ] 11.2 Реализовать генерацию структурированных данных
    - Создать SchemaGenerator для Schema.org разметки
    - Добавить Calculator schema для всех калькуляторов
    - Добавить FAQPage schema где применимо
    - Добавить BreadcrumbList schema
    - _Requirements: 7.3_

  - [ ]* 11.3 Написать property тест для SEO metadata
    - **Property 5: SEO metadata completeness**
    - **Validates: Requirements 7.1, 7.3**
    - Проверять каждую страницу калькулятора
    - Верифицировать наличие всех обязательных мета-тегов и structured data

  - [ ] 11.4 Добавить внутреннюю перелинковку
    - Создать RelatedCalculators компонент
    - Добавить логику определения связанных калькуляторов
    - Интегрировать в CalculatorPageWrapper
    - _Requirements: 7.6_

  - [ ]* 11.5 Написать property тест для внутренней перелинковки
    - **Property 6: Internal linking connectivity**
    - **Validates: Requirements 7.6**
    - Проверять каждую страницу калькулятора
    - Верифицировать наличие минимум 3 внутренних ссылок

  - [ ] 11.6 Обновить sitemap.xml
    - Генерировать sitemap программно на основе списка калькуляторов
    - Добавить приоритеты и частоту обновления
    - _Requirements: 7.2_

- [ ] 12. Оптимизация производительности
  - [ ] 12.1 Настроить code splitting по маршрутам
    - Использовать React.lazy для ленивой загрузки страниц калькуляторов
    - Добавить Suspense с loading indicators
    - _Requirements: 2.2, 2.4_

  - [ ] 12.2 Оптимизировать bundle size
    - Настроить tree shaking в Vite
    - Разделить vendor chunks
    - Использовать dynamic imports для тяжелых библиотек
    - _Requirements: 2.3_

  - [ ] 12.3 Настроить кэширование
    - Добавить service worker для PWA
    - Настроить cache-control headers
    - Реализовать offline fallback
    - _Requirements: 2.5, 6.6_

  - [ ] 12.4 Измерить и оптимизировать до целевых метрик
    - Запустить Lighthouse CI
    - Оптимизировать до Lighthouse Score > 90
    - Проверить bundle size < 300KB initial
    - _Requirements: 2.6_

- [ ] 13. Улучшение UX и доступности
  - [ ] 13.1 Стандартизировать UI компоненты
    - Создать единый InputField компонент с валидацией
    - Создать единый ResultDisplay компонент
    - Добавить tooltips и help text ко всем полям
    - _Requirements: 5.1, 5.2, 5.4_

  - [ ] 13.2 Добавить ARIA labels и accessibility
    - Добавить aria-label ко всем интерактивным элементам
    - Обеспечить keyboard navigation
    - Проверить контрастность цветов (WCAG AA)
    - _Requirements: 5.6_

  - [ ] 13.3 Оптимизировать для мобильных устройств
    - Проверить responsive design на всех breakpoints
    - Оптимизировать touch targets (минимум 44x44px)
    - Добавить mobile-specific optimizations
    - _Requirements: 5.5_

  - [ ]* 13.4 Написать E2E тесты для критических путей
    - Тестировать полный flow: открытие калькулятора → ввод данных → расчет → экспорт
    - Тестировать на desktop и mobile viewports
    - _Requirements: 3.4, 5.1_

- [ ] 14. Checkpoint - UX и производительность
  - Убедиться, что Lighthouse Score > 90
  - Проверить доступность на screen readers
  - Проверить работу на мобильных устройствах
  - Спросить пользователя, если возникли вопросы

- [ ] 15. Документация и процессы
  - [ ] 15.1 Обновить README.md
    - Добавить инструкции по установке и запуску
    - Документировать доступные npm scripts
    - Добавить troubleshooting секцию
    - _Requirements: 9.1_

  - [ ] 15.2 Создать ARCHITECTURE.md
    - Документировать структуру проекта
    - Описать ключевые паттерны и принципы
    - Добавить диаграммы архитектуры
    - _Requirements: 9.2_

  - [ ] 15.3 Создать CONTRIBUTING.md
    - Написать руководство по добавлению новых калькуляторов
    - Документировать процесс code review
    - Добавить code style guide
    - _Requirements: 9.3, 9.4, 9.6_

  - [ ] 15.4 Настроить CI/CD pipeline
    - Настроить GitHub Actions для автоматического тестирования
    - Добавить автоматический deploy на staging/production
    - Настроить автоматический запуск Lighthouse CI
    - _Requirements: 9.5_

- [ ] 16. Финальная интеграция и тестирование
  - [ ] 16.1 Рефакторинг существующих калькуляторов
    - Мигрировать все калькуляторы на AbstractCalculator
    - Использовать useCalculatorCommon во всех калькуляторах
    - Обернуть все страницы в CalculatorPageWrapper
    - _Requirements: 4.1, 4.2_

  - [ ]* 16.2 Написать property тест для fallback механизмов
    - **Property 11: Fallback mechanism activation**
    - **Validates: Requirements 10.4**
    - Симулировать сбои критических функций
    - Проверять автоматическую активацию fallback

  - [ ]* 16.3 Запустить полный набор тестов
    - Выполнить все unit тесты
    - Выполнить все property тесты (100+ итераций каждый)
    - Выполнить все E2E тесты
    - Проверить coverage > 85%
    - _Requirements: 3.1, 3.2, 3.3, 3.4_

  - [ ] 16.4 Провести финальный аудит
    - Запустить Lighthouse для всех страниц
    - Проверить все SEO метрики
    - Проверить работу аналитики
    - Проверить безопасность (XSS, валидация, rate limiting)
    - _Requirements: 2.6, 7.1, 7.3, 8.1, 10.1, 10.2, 10.6_

- [ ] 17. Final Checkpoint
  - Убедиться, что все тесты проходят (100% success rate)
  - Проверить, что все 12 correctness properties выполняются
  - Проверить, что все целевые метрики достигнуты
  - Спросить пользователя о готовности к релизу

## Notes

- Задачи, помеченные `*`, являются опциональными и могут быть пропущены для более быстрого MVP
- Каждая задача ссылается на конкретные требования для трассируемости
- Checkpoints обеспечивают инкрементальную валидацию прогресса
- Property тесты валидируют универсальные свойства корректности
- Unit тесты валидируют конкретные примеры и граничные случаи
- Все задачи построены инкрементально - каждая следующая использует результаты предыдущих
