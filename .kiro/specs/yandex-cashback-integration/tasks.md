# План реализации: Интеграция Яндекс Кешбэка

## Обзор

Поэтапная реализация деликатной интеграции партнерской ссылки Яндекс Кешбэка в сайт калькуляторов с фокусом на пользу для посетителей и соблюдение правовых требований.

## Задачи

- [x] 1. Создание базовой инфраструктуры кешбэка
  - Создать типы TypeScript для кешбэк функциональности
  - Создать утилиты для генерации ссылок и сообщений
  - Настроить конфигурацию кешбэка
  - _Требования: 1.3, 2.4, 3.3_

- [x] 1.1 Написать property тест для генерации UTM параметров
  - **Property 7: UTM parameter generation**
  - **Validates: Requirements 3.3**

- [ ] 2. Реализация компонента CashbackFooterSection
  - Создать React компонент для отображения кешбэка в футере
  - Интегрировать компонент в существующий Footer.tsx
  - Добавить стили в соответствии с дизайн-системой
  - _Требования: 1.1, 1.2, 1.5_

- [ ] 2.1 Написать property тест для содержимого кешбэк компонента
  - **Property 1: Cashback component content validation**
  - **Validates: Requirements 1.2**

- [ ] 2.2 Написать unit тест для отображения конкретного текста
  - Проверить отображение текста "Экономьте на покупках с Яндекс Кешбэком"
  - _Требования: 1.5_

- [ ] 3. Реализация компонента CashbackTip
  - Создать компонент для контекстных советов в калькуляторах
  - Реализовать логику выбора сообщения по типу калькулятора
  - Добавить поддержку персонализации по сумме расчета
  - _Требования: 2.1, 2.2, 2.3, 2.4_

- [ ] 3.1 Написать property тест для отображения советов по типу калькулятора
  - **Property 3: Contextual advice display by calculator type**
  - **Validates: Requirements 2.1, 2.2, 2.3**

- [ ] 3.2 Написать property тест для наличия партнерской ссылки в советах
  - **Property 4: Contextual advice contains partner link**
  - **Validates: Requirements 2.4**

- [ ] 4. Интеграция аналитики и отслеживания
  - Создать хук useCashbackAnalytics для централизованной аналитики
  - Интегрировать отслеживание кликов с Яндекс.Метрикой
  - Реализовать различение источников событий
  - _Требования: 3.1, 3.2_

- [ ] 4.1 Написать property тест для отслеживания аналитических событий
  - **Property 5: Analytics event tracking**
  - **Validates: Requirements 3.1**

- [ ] 4.2 Написать property тест для различения источников аналитики
  - **Property 6: Analytics source differentiation**
  - **Validates: Requirements 3.2**

- [ ] 5. Интеграция в калькуляторы
  - Добавить CashbackTip в CreditCalculator.tsx
  - Добавить CashbackTip в MortgageCalculator.tsx (если существует)
  - Добавить CashbackTip в SalaryCalculator.tsx (если существует)
  - Настроить отображение советов в результатах расчетов
  - _Требования: 2.1, 2.2, 2.3_

- [ ] 6. Checkpoint - Базовая функциональность
  - Убедиться, что все компоненты корректно отображаются
  - Проверить работу кликов и навигации
  - Убедиться, что аналитика отправляется
  - Спросить пользователя, если возникают вопросы

- [ ] 7. Реализация адаптивности и доступности
  - Добавить адаптивные стили для мобильных устройств
  - Реализовать ARIA-метки для всех интерактивных элементов
  - Добавить поддержку навигации с клавиатуры
  - _Требования: 4.1, 4.2, 4.4_

- [ ] 7.1 Написать property тест для адаптивности
  - **Property 8: Responsive design compliance**
  - **Validates: Requirements 4.1, 4.2**

- [ ] 7.2 Написать property тест для доступности
  - **Property 9: Accessibility compliance**
  - **Validates: Requirements 4.4**

- [ ] 8. Соблюдение правовых требований
  - Добавить пометки "Партнерская ссылка" во все кешбэк компоненты
  - Настроить атрибуты rel="sponsored nofollow" для всех партнерских ссылок
  - Проверить соответствие рекламному законодательству
  - _Требования: 5.1, 5.3_

- [ ] 8.1 Написать property тест для правовых меток
  - **Property 10: Legal compliance labeling**
  - **Validates: Requirements 5.1**

- [ ] 8.2 Написать property тест для атрибутов партнерских ссылок
  - **Property 11: Partner link attributes**
  - **Validates: Requirements 5.3**

- [ ] 9. Обработка ошибок и fallback
  - Реализовать graceful degradation при ошибках
  - Добавить логирование ошибок
  - Создать fallback для недоступности внешних ресурсов
  - _Требования: общая надежность системы_

- [ ] 9.1 Написать unit тесты для обработки ошибок
  - Тестировать поведение при недоступности аналитики
  - Тестировать fallback при ошибках конфигурации

- [ ] 10. Оптимизация производительности
  - Реализовать lazy loading для кешбэк компонентов
  - Добавить мемоизацию для генерации сообщений
  - Настроить debouncing для аналитических событий
  - _Требования: 4.3 (косвенно)_

- [ ] 11. Финальная интеграция и тестирование
  - Интегрировать все компоненты в основное приложение
  - Проверить работу на всех страницах сайта
  - Протестировать на различных устройствах и браузерах
  - _Требования: все_

- [ ] 11.1 Написать property тест для навигации по кешбэк ссылкам
  - **Property 2: Cashback link navigation**
  - **Validates: Requirements 1.3**

- [ ] 12. Финальный checkpoint - Убедиться, что все тесты проходят
  - Убедиться, что все тесты проходят, спросить пользователя, если возникают вопросы

## Примечания

- Каждая задача ссылается на конкретные требования для отслеживаемости
- Checkpoint'ы обеспечивают инкрементальную валидацию
- Property тесты валидируют универсальные свойства корректности
- Unit тесты валидируют конкретные примеры и граничные случаи
- Все задачи являются обязательными для комплексной реализации