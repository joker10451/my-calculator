import type { BlogPost } from '@/types/blog';

/**
 * Шаблоны для разных типов статей блога
 * Используются для создания новых статей с предзаполненной структурой
 */

export interface ArticleTemplate {
  type: 'guide' | 'review' | 'comparison';
  name: string;
  description: string;
  contentStructure: string;
  sections: string[];
  recommendedLength: number;
  requiredElements: string[];
}

/**
 * Шаблон для гайдов (guides)
 * Подробные пошаговые инструкции и руководства
 */
export const guideTemplate: ArticleTemplate = {
  type: 'guide',
  name: 'Гайд / Руководство',
  description: 'Пошаговая инструкция с детальным объяснением процесса',
  contentStructure: `# [Название гайда]

## Введение
[Краткое описание проблемы и того, что читатель узнает из гайда]

## Что вам понадобится
- [Необходимый документ/инструмент 1]
- [Необходимый документ/инструмент 2]
- [Необходимый документ/инструмент 3]

## Шаг 1: [Название первого шага]
[Детальное описание первого шага с примерами]

### Важные моменты:
- [Ключевой момент 1]
- [Ключевой момент 2]

## Шаг 2: [Название второго шага]
[Детальное описание второго шага]

### Частые ошибки:
- [Ошибка 1 и как её избежать]
- [Ошибка 2 и как её избежать]

## Шаг 3: [Название третьего шага]
[Детальное описание третьего шага]

## Практический пример
[Реальный пример с конкретными цифрами и расчетами]

## Полезные советы
- [Совет 1]
- [Совет 2]
- [Совет 3]

## Часто задаваемые вопросы

### Вопрос 1?
[Ответ на вопрос 1]

### Вопрос 2?
[Ответ на вопрос 2]

### Вопрос 3?
[Ответ на вопрос 3]

## Заключение
[Краткое резюме и призыв к действию]

**[Призыв использовать калькулятор]** с помощью нашего калькулятора!`,
  sections: [
    'Введение',
    'Что вам понадобится',
    'Пошаговая инструкция (минимум 3 шага)',
    'Практический пример',
    'Полезные советы',
    'Часто задаваемые вопросы',
    'Заключение'
  ],
  recommendedLength: 2500,
  requiredElements: [
    'Пошаговая структура',
    'Практические примеры',
    'Ссылка на калькулятор',
    'FAQ секция',
    'Визуальные элементы (списки, таблицы)'
  ]
};

/**
 * Шаблон для обзоров (reviews)
 * Детальный анализ продукта, услуги или программы
 */
export const reviewTemplate: ArticleTemplate = {
  type: 'review',
  name: 'Обзор',
  description: 'Детальный анализ с оценкой преимуществ и недостатков',
  contentStructure: `# Обзор: [Название продукта/услуги]

## Краткая информация
[Основные характеристики в 2-3 предложениях]

## Что это такое
[Подробное описание продукта/услуги/программы]

## Основные характеристики

### Характеристика 1
[Описание]

### Характеристика 2
[Описание]

### Характеристика 3
[Описание]

## Преимущества

### ✅ Преимущество 1
[Детальное описание]

### ✅ Преимущество 2
[Детальное описание]

### ✅ Преимущество 3
[Детальное описание]

## Недостатки

### ❌ Недостаток 1
[Детальное описание]

### ❌ Недостаток 2
[Детальное описание]

## Для кого подходит
- [Целевая аудитория 1]
- [Целевая аудитория 2]
- [Целевая аудитория 3]

## Для кого не подходит
- [Кому не рекомендуется]
- [Ограничения]

## Стоимость и условия
[Детальная информация о ценах, тарифах, условиях]

## Как оформить / Как получить
[Пошаговая инструкция]

## Альтернативы
[Краткое сравнение с альтернативными вариантами]

## Реальные отзывы
[Примеры отзывов пользователей]

## Наша оценка

**Общая оценка: [X]/10**

- Удобство: [X]/10
- Выгода: [X]/10
- Надежность: [X]/10

## Заключение
[Итоговая рекомендация]

**[Призыв использовать калькулятор]** для расчета!`,
  sections: [
    'Краткая информация',
    'Что это такое',
    'Основные характеристики',
    'Преимущества',
    'Недостатки',
    'Для кого подходит',
    'Стоимость и условия',
    'Как оформить',
    'Альтернативы',
    'Наша оценка',
    'Заключение'
  ],
  recommendedLength: 3000,
  requiredElements: [
    'Преимущества и недостатки',
    'Целевая аудитория',
    'Оценка по критериям',
    'Ссылка на калькулятор',
    'Альтернативные варианты'
  ]
};

/**
 * Шаблон для сравнений (comparisons)
 * Сравнительный анализ нескольких вариантов
 */
export const comparisonTemplate: ArticleTemplate = {
  type: 'comparison',
  name: 'Сравнение',
  description: 'Детальное сравнение нескольких вариантов с выводами',
  contentStructure: `# Сравнение: [Вариант 1] vs [Вариант 2] vs [Вариант 3]

## Введение
[Зачем нужно сравнение, что будем сравнивать]

## Краткая справка

### [Вариант 1]
[Краткое описание]

### [Вариант 2]
[Краткое описание]

### [Вариант 3]
[Краткое описание]

## Сравнительная таблица

| Критерий | Вариант 1 | Вариант 2 | Вариант 3 |
|----------|-----------|-----------|-----------|
| Стоимость | [значение] | [значение] | [значение] |
| Условия | [значение] | [значение] | [значение] |
| Преимущества | [значение] | [значение] | [значение] |
| Ограничения | [значение] | [значение] | [значение] |

## Детальное сравнение

### По стоимости
[Подробное сравнение цен и тарифов]

**Вывод:** [Какой вариант выгоднее]

### По условиям
[Подробное сравнение условий]

**Вывод:** [Какой вариант удобнее]

### По надежности
[Подробное сравнение надежности]

**Вывод:** [Какой вариант надежнее]

## Практические примеры

### Пример 1: [Ситуация]
- **Вариант 1:** [результат]
- **Вариант 2:** [результат]
- **Вариант 3:** [результат]
- **Лучший выбор:** [вариант и почему]

### Пример 2: [Ситуация]
- **Вариант 1:** [результат]
- **Вариант 2:** [результат]
- **Вариант 3:** [результат]
- **Лучший выбор:** [вариант и почему]

## Что выбрать в разных ситуациях

### Если вам нужно [цель 1]
**Рекомендуем:** [Вариант X]
**Почему:** [обоснование]

### Если вам нужно [цель 2]
**Рекомендуем:** [Вариант Y]
**Почему:** [обоснование]

### Если вам нужно [цель 3]
**Рекомендуем:** [Вариант Z]
**Почему:** [обоснование]

## Итоговая таблица рекомендаций

| Ваша ситуация | Лучший выбор | Почему |
|---------------|--------------|--------|
| [Ситуация 1] | [Вариант] | [Причина] |
| [Ситуация 2] | [Вариант] | [Причина] |
| [Ситуация 3] | [Вариант] | [Причина] |

## Заключение
[Итоговые рекомендации и выводы]

**Рассчитайте свой вариант** с помощью нашего калькулятора!`,
  sections: [
    'Введение',
    'Краткая справка',
    'Сравнительная таблица',
    'Детальное сравнение по критериям',
    'Практические примеры',
    'Рекомендации для разных ситуаций',
    'Итоговая таблица',
    'Заключение'
  ],
  recommendedLength: 3500,
  requiredElements: [
    'Сравнительная таблица',
    'Минимум 3 критерия сравнения',
    'Практические примеры',
    'Рекомендации для разных ситуаций',
    'Ссылка на калькулятор'
  ]
};

/**
 * Получить шаблон по типу
 */
export function getTemplateByType(type: 'guide' | 'review' | 'comparison'): ArticleTemplate {
  switch (type) {
    case 'guide':
      return guideTemplate;
    case 'review':
      return reviewTemplate;
    case 'comparison':
      return comparisonTemplate;
    default:
      return guideTemplate;
  }
}

/**
 * Создать заготовку статьи на основе шаблона
 */
export function createArticleFromTemplate(
  template: ArticleTemplate,
  title: string,
  categoryId: string
): Partial<BlogPost> {
  return {
    title,
    content: template.contentStructure,
    excerpt: '',
    tags: [],
    category: { id: categoryId } as any,
    isPublished: false,
    isFeatured: false,
    readingTime: Math.ceil(template.recommendedLength / 200),
    relatedCalculators: []
  };
}

/**
 * Валидация статьи по шаблону
 */
export function validateArticleAgainstTemplate(
  article: Partial<BlogPost>,
  template: ArticleTemplate
): { isValid: boolean; missingElements: string[] } {
  const missingElements: string[] = [];
  const content = article.content || '';

  // Проверка обязательных элементов
  template.requiredElements.forEach(element => {
    if (element === 'Ссылка на калькулятор' && !article.relatedCalculators?.length) {
      missingElements.push(element);
    }
    // Дополнительные проверки можно добавить здесь
  });

  // Проверка минимальной длины
  const wordCount = content.split(/\s+/).length;
  if (wordCount < template.recommendedLength * 0.8) {
    missingElements.push(`Недостаточная длина (минимум ${template.recommendedLength} слов)`);
  }

  return {
    isValid: missingElements.length === 0,
    missingElements
  };
}

export const articleTemplates = {
  guide: guideTemplate,
  review: reviewTemplate,
  comparison: comparisonTemplate
};
